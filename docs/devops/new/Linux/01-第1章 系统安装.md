# ç¬¬1ç«  ç³»ç»Ÿå®‰è£…

## 1  ç³»ç»Ÿå®‰è£…

æœ¬æ–‡åŸºäºCentOS7æœ€å°åŒ–å®‰è£…ï¼Œä¸»æœºå`wenqiu`ã€‚

### 1.1 åˆ†åŒºè§„åˆ’

ç”±äºå®‰è£…ç›®çš„æ˜¯å­¦ä¹ æ¼”ç»ƒï¼Œå¯èƒ½ä¼šå®‰è£…å¾ˆå¤šè½¯ä»¶ï¼Œä¿å­˜å¾ˆå¤šå®‰è£…åŒ…ï¼Œæ‰€ä»¥åˆ†é…300Gç”¨æ¥ä½¿ç”¨ï¼ˆæˆ‘è¯•è¿‡100Gä¸å¤Ÿç”¨çš„æƒ…å†µï¼‰ï¼Œå¦‚æœæ˜¯ä¸€èˆ¬æ€§ç³»ç»Ÿå®‰è£…ï¼Œåˆ†é…50Gä¹Ÿå°±å¤Ÿäº†ã€‚åˆ†åŒºæ ¼å¼RHEL7å¼€å§‹é‡‡ç”¨`XSF`æ ¼å¼ã€‚

| æŒ‚è½½ç‚¹ | è¯´æ˜                                                         |
| ------ | ------------------------------------------------------------ |
| /boot  | ä¸»åˆ†åŒºï¼Œå­˜æ”¾Linuxå¯åŠ¨æ‰€éœ€çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œæ¨èå¤§å°200Mè¶³å¤Ÿï¼Œåˆ†é…1G |
| /      | é€»è¾‘åˆ†åŒºï¼Œåˆ†é…50G                                            |
| /home  | é€»è¾‘åˆ†åŒºï¼Œåˆ†é…50G                                            |
| swap   | é€»è¾‘åˆ†åŒºï¼Œè™šæ‹Ÿå†…å­˜ï¼Œåˆ†åŒºæ ¼å¼swapï¼Œåˆ†é…5G                     |
| /var   | é€»è¾‘åˆ†åŒºï¼Œåˆ†é…70G                                            |
| /tmp   | é€»è¾‘åˆ†åŒºï¼Œåˆ†é…20G                                            |
| /usr   | é€»è¾‘åˆ†åŒºï¼Œå‰©ä¸‹å…¨éƒ¨ç©ºé—´ï¼ˆå¤§çº¦105Gå·¦å³ï¼‰                       |

<span style="color:red;font-weight:bold;">å¤šå¹´ä½¿ç”¨å¿ƒå¾—ï¼šå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€è¦ï¼Œå»ºè®®åˆ†3ä¸ªåŒºï¼ˆæˆ–4ä¸ªåˆ†åŒºï¼ŒåŒ…å«/boot/efiåˆ†åŒºï¼‰å³å¯ï¼š</span>

| æŒ‚è½½ç‚¹    | è¯´æ˜                                                         |
| --------- | ------------------------------------------------------------ |
| /boot/efi | ä¸ºä½¿ç”¨EFIå›ºä»¶çš„ç³»ç»Ÿè®¾ç½®çš„ç‰¹å®šç›®å½•ï¼Œç”¨äºå­˜æ”¾EFIå¯åŠ¨åŠ è½½å™¨ç­‰å†…å®¹ã€‚åˆ†é…300MiB |
| /boot     | å­˜æ”¾Linuxå¯åŠ¨æ‰€éœ€çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œæ¨èå¤§å°200Mè¶³å¤Ÿã€‚åˆ†é…1024MiB   |
| swap      | è™šæ‹Ÿå†…å­˜ï¼Œåˆ†åŒºæ ¼å¼swapï¼Œåˆ†é…å¤§å°ä¸å†…å­˜ç›¸å…³ã€‚åˆ†é…1024MiB      |
| /         | å‰©ä½™æ‰€æœ‰å¯åˆ†é…å†…å­˜ï¼Œæ¯”å¦‚100GåŸºæœ¬å¾ˆå¤šåœºæ™¯éƒ½å¤Ÿç”¨ã€‚             |

å…¶ä¸­`swap`åˆ†åŒºçš„å¤§å°è¯´æ˜å¦‚ä¸‹ï¼š

| ç‰©ç†å†…å­˜ | ä¹‹å‰äº¤æ¢åˆ†åŒºæ–¹æ¡ˆï¼ˆswapï¼‰  | ç°åœ¨äº¤æ¢åˆ†åŒºæ–¹æ¡ˆï¼ˆswapï¼‰ |
| :------- | :------------------------ | ------------------------ |
| <=4G     | è‡³å°‘4Gï¼Œæˆ–è€…ç‰©ç†å†…å­˜çš„2å€ | 4GB                      |
| 4~16G    | è‡³å°‘8Gï¼Œæˆ–è€…ç‰©ç†å†…å­˜çš„1å€ | 2GB                      |
| 16~64G   | è‡³å°‘16G                   | 1GB                      |
| 64~256G  | è‡³å°‘32G                   | 1GB                      |

<span style="color:#1E90FF;font-weight:bold;">æ¥æºï¼šRed Hat/Oracle/SUSEç­‰ä¼ä¸šå‘è¡Œç‰ˆçš„æ—§æ–‡æ¡£</span> <span style="color:red;font-weight:bold;">ä½†è¿™äº›æŒ‡å—åœ¨SSDå’Œç°ä»£å†…å­˜ç®¡ç†ä¸‹å·²ç»è¿‡æ—¶ï¼</span>

### 1.2 IPè§„åˆ’

#### 1.2.1 ä¿®æ”¹vmnet8é…ç½®

- æŸ¥çœ‹vmnet8é…ç½®

```bash
$ cat /Library/Preferences/VMware\ Fusion/vmnet8/nat.conf | grep gateway -A 15
# NAT gateway address
ip = 192.168.38.2
netmask = 255.255.255.0

# VMnet device if not specified on command line
device = vmnet8

# Allow PORT/EPRT FTP commands (they need incoming TCP stream ...)
activeFTP = 1

# Allows the source to have any OUI.  Turn this on if you change the OUI
# in the MAC address of your virtual machines.
allowAnyOUI = 1

# VMnet host IP address
hostIp = 192.168.38.1
```

- æŸ¥çœ‹networking

```bash
$ cat /Library/Preferences/VMware\ Fusion/networking | grep VNET_8
answer VNET_8_DHCP yes
answer VNET_8_DHCP_CFG_HASH 2DBB4D4D907BE791328BF30A7AB42BBE24CAB5DF
answer VNET_8_HOSTONLY_NETMASK 255.255.255.0
answer VNET_8_HOSTONLY_SUBNET 192.168.38.0
answer VNET_8_HOSTONLY_UUID A618DECA-3566-4DDF-975B-D49AC5CCC4CC
answer VNET_8_NAT yes
answer VNET_8_VIRTUAL_ADAPTER yes
```

- ä¿®æ”¹vmnet8é…ç½®

```bash
# vimæ‰“å¼€ï¼Œå‘½ä»¤æ¨¡å¼ä¸‹æ›¿æ¢ :1,%s/192.168.38/192.168.200/g
$ sudo vim /Library/Preferences/VMware\ Fusion/vmnet8/nat.conf
```

- ä¿®æ”¹networkingå…³äºVNET_8çš„é…ç½®

```bash
$ sudo vim /Library/Preferences/VMware\ Fusion/networking 
```

![image-20241231143726222](images/image-20241231143726222.png)

<span style="color:red;font-weight:bold;">æ³¨æ„ï¼šè¿™é‡Œ answer VNET_8_DHCP no å»ºè®®ä¸º yes</span>

<span style="color:red;font-weight:bold;">ä¿®æ”¹åé‡å¯VMware Fusionï¼Œç¡®ä¿å­ç½‘ç½‘æ®µèƒ½pingé€šï¼ˆæ—§ç½‘æ®µåº”è¯¥å°±ä¸é€šäº†ï¼‰</span>

```bash
$ ping 192.168.200.0
PING 192.168.200.0 (192.168.200.0): 56 data bytes
64 bytes from 192.168.200.2: icmp_seq=0 ttl=128 time=0.221 ms
```

#### 1.2.2 ä¸ºé»„é‡‘é•œåƒ VM çš„ MAC åœ°å€ä¿ç•™ IP

- åœ¨ `dhcpd.conf` æ–‡ä»¶æœ«å°¾æ·»åŠ ä¿ç•™IP

```bash
$ sudo vim /Library/Preferences/VMware\ Fusion/vmnet8/dhcpd.conf
```

```bash
# é»„é‡‘é•œåƒå›ºå®šIPé…ç½®
host golden-vm {
    hardware ethernet 00:50:56:AA:BB:CC;  # â† æ›¿æ¢ä¸ºä½ çš„ VM MAC
    fixed-address 192.168.200.100;
}
# ä¸‹é¢çš„ä¸å¿…è¦
host node1-vm {
    hardware ethernet 00:50:56:33:CF:6E;
    fixed-address 192.168.200.116;
}
host node2-vm {
    hardware ethernet 00:50:56:2E:DD:56;
    fixed-address 192.168.200.117;
}
host node3-vm {
    hardware ethernet 00:50:56:22:DA:59;
    fixed-address 192.168.200.118;
}
host other-vm {
    hardware ethernet 00:50:56:2B:B8:3D;
    fixed-address 192.168.200.119;
}
```

- é‡å¯ VMware ç½‘ç»œæœåŠ¡

```bash
$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --stop
$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --start
```

æˆ–ç›´æ¥é‡å¯ Fusion åº”ç”¨ã€‚

### 1.3 MacBookå®‰è£…é…ç½®

- <span style="color:red;font-weight:bold;">æ¦‚è¿°ï¼š4CPU+16Gå†…å­˜+64Gç¡¬ç›˜+æ ‡å‡†åˆ†åŒºï¼Œéå¿…è¦ä¸ä½¿ç”¨rootç”¨æˆ·ï¼ï¼ï¼</span>

- åˆ†åŒº

| æŒ‚è½½ç‚¹    | å¤§å°         | è¯´æ˜                                                         | è®¾å¤‡ç±»å‹ | æ–‡ä»¶ç³»ç»Ÿ             |
| --------- | ------------ | ------------------------------------------------------------ | -------- | -------------------- |
| /boot/efi | 300MiB       | ä¸ºä½¿ç”¨EFIå›ºä»¶çš„ç³»ç»Ÿè®¾ç½®çš„ç‰¹å®šç›®å½•ï¼Œ<br />ç”¨äºå­˜æ”¾EFIå¯åŠ¨åŠ è½½å™¨ç­‰å†…å®¹ã€‚åˆ†é…300MiB | æ ‡å‡†åˆ†åŒº | EFI System Partition |
| /boot     | 1024MiB      | å­˜æ”¾Linuxå¯åŠ¨æ‰€éœ€çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œ<br />æ¨èå¤§å°200Mè¶³å¤Ÿï¼Œåˆ†é…1024MiB | æ ‡å‡†åˆ†åŒº | xfs                  |
| swap      | 1024MiB      | è™šæ‹Ÿå†…å­˜ï¼Œåˆ†åŒºæ ¼å¼swapï¼Œåˆ†é…å¤§å°ä¸å†…å­˜ç›¸å…³                   | LVM      | swap                 |
| /         | å‰©ä¸‹å…¨éƒ¨ç©ºé—´ | å‰©ä¸‹å…¨éƒ¨ç©ºé—´                                                 | LVM      | Xfs                  |

<div style="height:620px;overflow-y:auto;">
  <img src="./images/image-20260112173828648.png"/>
  <img src="./images/image-20260117152159373.png"/>
  <img src="./images/image-20260117152320090.png"/>
  <img src="./images/image-20260117152332063.png"/>
  <img src="./images/image-20260117145618677.png"/>
  <img src="./images/image-20260117145625411.png"/>
  <img src="./images/image-20260117145608666.png"/>
  <img src="./images/image-20260113133342453.png"/>
</div>

- è½¯ä»¶
  - è½¯ä»¶é€‰æ‹©(S)
    - æœ€å°å®‰è£…
- ç³»ç»Ÿ
  - å®‰è£…ç›®æ ‡ä½ç½®(D)
    - è‡ªå®šä¹‰æ ‡å‡†åˆ†åŒº
  - KDUMP
    - å·²ç¦ç”¨Kdump
  - ç½‘ç»œå’Œä¸»æœºå(N)
    - ä¸»æœºåï¼šstandard
    - ä»¥å¤ªç½‘â€“è¿æ¥åç§°ï¼šeth0ï¼ˆ<span style="color:red;font-weight:bold;">ä¸è¦ä¿®æ”¹è®¾å¤‡å</span>ï¼‰

- ç”¨æˆ·è®¾ç½®
  - ROOTå¯†ç (R)ï¼š
    - é”å®šrootè´¦æˆ· âœ…
    - å…è®¸rootç”¨æˆ·ä½¿ç”¨å¯†ç è¿›è¡ŒSSHç™»å½• â
  - åˆ›å»ºç”¨æˆ·(U)
    - å…¨å(F)ï¼šemon
    - ç”¨æˆ·å(U)ï¼šemon
      - å°†æ­¤ç”¨æˆ·è®¾ä¸ºç®¡ç†å‘˜(M) âœ…
      - éœ€è¦å¯†ç æ‰èƒ½ä½¿ç”¨æ”¹è´¦æˆ·(R) âœ…

- æœ€å°åŒ–å®‰è£…å®Œæˆåé»˜è®¤æœåŠ¡æƒ…å†µ

```bash
[emon@standard ~]$ nmcli conn show
NAME  UUID                                  TYPE      DEVICE 
eth0  ff3922c5-c880-3f88-a35f-27133ce5de5d  ethernet  enp2s0 
lo    4b0f421b-9d44-4a56-853b-d45e118b3b72  loopback  lo     
[emon@standard ~]$ df -h
æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹
devtmpfs        4.0M     0  4.0M    0% /dev
tmpfs           7.8G     0  7.8G    0% /dev/shm
tmpfs           3.2G  8.8M  3.2G    1% /run
efivarfs        256K   34K  223K   14% /sys/firmware/efi/efivars
/dev/nvme0n1p4   62G  1.9G   60G    4% /
/dev/nvme0n1p2  960M  166M  795M   18% /boot
/dev/nvme0n1p1  300M  7.4M  293M    3% /boot/efi
tmpfs           1.6G     0  1.6G    0% /run/user/1000
[emon@standard ~]$ free -h
               total        used        free      shared  buff/cache   available
Mem:            15Gi       413Mi        15Gi       8.0Mi       177Mi        15Gi
Swap:          1.0Gi          0B       1.0Gi
[emon@standard ~]$ systemctl list-unit-files --type=service --state=enabled
UNIT FILE                          STATE   PRESET  
auditd.service                     enabled enabled 
chronyd.service                    enabled enabled 
crond.service                      enabled enabled 
dbus-broker.service                enabled enabled 
firewalld.service                  enabled enabled 
getty@.service                     enabled enabled 
irqbalance.service                 enabled enabled 
kdump.service                      enabled enabled 
mdmonitor.service                  enabled enabled 
NetworkManager-dispatcher.service  enabled enabled 
NetworkManager-wait-online.service enabled disabled
NetworkManager.service             enabled enabled 
nis-domainname.service             enabled enabled 
nvmefc-boot-connections.service    enabled enabled 
rsyslog.service                    enabled enabled 
selinux-autorelabel-mark.service   enabled enabled 
sshd.service                       enabled enabled 
sssd.service                       enabled enabled 
systemd-boot-update.service        enabled enabled 
systemd-network-generator.service  enabled enabled 
udisks2.service                    enabled enabled 

21 unit files listed.
```

## 2 åŸºç¡€é…ç½®ï¼ˆé»„é‡‘é•œåƒï¼‰

<span style="color: #FFD700; font-weight: bold; font-size: 30px; font-family: monospace; background: linear-gradient(90deg, #b8860b, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ğŸ† é»„é‡‘é•œåƒï¼šrocky9-arm64-standard-vmware-20260118</span>

### 2.1 ä¿®æ”¹vimçš„ç¼©è¿›ä¸º4ä¸ªç©ºæ ¼

æ‰“å¼€æ–‡ä»¶åï¼Œåœ¨æœ€åä¸€è¡Œè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
$ sudo tee -a /etc/vimrc  <<'EOF'
" ä¸ªäººé…ç½®
set tabstop=4
set softtabstop=4
set shiftwidth=4
set expandtab
" å¦‚ä¸‹è®¾ç½®ï¼Œåœ¨vimçš„æ’å…¥æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»F9å¯ä»¥è¿›å…¥â€œæ’å…¥(ç²˜è´´)â€æ¨¡å¼ï¼Œå†æ‰§è¡Œç²˜è´´æ—¶ä¸ä¼šæ··ä¹±æ ¼å¼ï¼›å†æ¬¡ç‚¹å‡»F9é€€å‡ºâ€œæ’å…¥(ç²˜è´´)â€æ¨¡å¼ã€‚
set pastetoggle=<F9>
EOF
```

### 2.2 é…ç½®è™šæ‹Ÿæœºå…±äº«æ–‡ä»¶å¤¹

- æ›´æ–°ç³»ç»ŸåŒ…

```bash
$ sudo dnf update -y
```

- å®‰è£…`open-vm-tools`

```bash
$ sudo dnf install -y open-vm-tools
```

```bash
# æŸ¥çœ‹å…±äº«æ–‡ä»¶åç§°
$ vmware-hgfsclient
```

- å®‰è£…æ¡Œé¢å¢å¼ºç»„ä»¶ï¼ˆå¦‚æœä½¿ç”¨å›¾å½¢ç•Œé¢ï¼‰

```bash
$ sudo dnf install -y open-vm-tools-desktop
```

- ä¸´æ—¶æŒ‚è½½å…±äº«æ–‡ä»¶å¤¹ï¼ˆé‡å¯å¤±æ•ˆï¼‰

```bash
# .host:Sharing è¡¨ç¤ºè™šæ‹Ÿæœºå…±äº«æ–‡ä»¶å¤¹Sharing
$ sudo vmhgfs-fuse .host:/Sharing /mnt/hgfs -o subtype=vmhgfs-fuse,allow_other,uid=1000,gid=1000,noatime
```

```bash
# æŸ¥çœ‹å…±äº«æ–‡ä»¶å¤¹
$ ls /mnt/hgfs
# å¸è½½
$ sudo umount /mnt/hgfs
```

### 2.3 ä½¿ç”¨ç³»ç»Ÿé•œåƒæ–‡ä»¶é…ç½®æœ¬åœ°yumæº

1. åŸºäºå…±äº«æ–‡ä»¶åˆ›å»ºdnfæº

:::details è¯¦æƒ…

```bash
# åœ¨å­Shellä¸­æ‰§è¡Œ
(
#!/bin/bash
set -euo pipefail

HGFS_MOUNT="/mnt/hgfs"
LOCAL_REPO_MOUNT="/mnt/localrepo"
REPO_NAME="Rocky9"
ISO_NAME="Rocky-9.7-aarch64-dvd.iso"
ISO_PATH="${HGFS_MOUNT}/${ISO_NAME}"

sudo mkdir -p "${HGFS_MOUNT}" "${LOCAL_REPO_MOUNT}"

# -------------------------------------------------------------------
# HGFS service â€” æ³¨æ„ï¼šæ­¤å¤„ä½¿ç”¨ <<EOFï¼ˆæ— å¼•å·ï¼‰ä»¥å±•å¼€ HGFS_MOUNT
# -------------------------------------------------------------------
sudo tee /etc/systemd/system/mnt-hgfs.service > /dev/null <<EOF
[Unit]
Description=Mount VMware HGFS Shared Folder
After=vmtoolsd.service
Requires=vmtoolsd.service

[Service]
Type=oneshot
ExecStart=/bin/sh -c '/usr/bin/vmhgfs-fuse .host:/Sharing ${HGFS_MOUNT} -o subtype=vmhgfs-fuse,allow_other,uid=1000,gid=1000,noatime'
ExecStop=/bin/umount ${HGFS_MOUNT}
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
EOF

# -------------------------------------------------------------------
# ISO automount â€” mnt-localrepo.mount éœ€è¦å±•å¼€ ISO_PATHï¼Œä¹Ÿç”¨ <<EOF
# -------------------------------------------------------------------
sudo tee /etc/systemd/system/mnt-localrepo.automount > /dev/null <<'EOF'
[Unit]
Description=Auto-mount Local ISO Repository
[Automount]
Where=/mnt/localrepo
TimeoutIdleSec=300
[Install]
WantedBy=multi-user.target
EOF

sudo tee /etc/systemd/system/mnt-localrepo.mount > /dev/null <<EOF
[Unit]
Description=Local ISO Repository for ${REPO_NAME}
After=mnt-hgfs.service
Wants=mnt-hgfs.service
[Mount]
What=${ISO_PATH}
Where=/mnt/localrepo
Type=iso9660
Options=loop,ro,nosuid,nodev
[Install]
WantedBy=multi-user.target
EOF

# -------------------------------------------------------------------
# DNF repos â€” åŒæ ·éœ€è¦å˜é‡å±•å¼€
# -------------------------------------------------------------------
sudo tee /etc/yum.repos.d/${REPO_NAME}-BaseOS.repo > /dev/null <<EOF
[${REPO_NAME}-BaseOS]
name=${REPO_NAME} BaseOS
baseurl=file://${LOCAL_REPO_MOUNT}/BaseOS
enabled=1
gpgcheck=0
EOF

sudo tee /etc/yum.repos.d/${REPO_NAME}-AppStream.repo > /dev/null <<EOF
[${REPO_NAME}-AppStream]
name=${REPO_NAME} AppStream
baseurl=file://${LOCAL_REPO_MOUNT}/AppStream
enabled=1
gpgcheck=0
EOF

# -------------------------------------------------------------------
# VMware resume script â€” å†…å®¹å›ºå®šï¼Œç”¨ 'EOF'
# -------------------------------------------------------------------
VMWARE_SCRIPT_DIR="/etc/vmware-tools/scripts/vmware"
sudo mkdir -p "${VMWARE_SCRIPT_DIR}"
sudo tee "${VMWARE_SCRIPT_DIR}/resume" > /dev/null <<'EOF'
#!/bin/bash
systemctl restart mnt-hgfs.service
EOF
sudo chmod +x "${VMWARE_SCRIPT_DIR}/resume"

# -------------------------------------------------------------------
# Enable services
# -------------------------------------------------------------------
sudo systemctl daemon-reload
sudo systemctl enable --now mnt-hgfs.service
sudo systemctl enable --now mnt-localrepo.automount

echo "âœ… Deployment completed."
echo "ğŸ“ HGFS share: ${HGFS_MOUNT}"
echo "ğŸ“¦ Local repo: ${LOCAL_REPO_MOUNT}"
echo "ğŸ’¡ The ISO will be mounted automatically on first access."
)
```

:::

2. æ›´æ¢yumæºé…ç½®ä¸ºé˜¿é‡Œäº‘é…ç½®

   1. å¤‡ä»½

   ```bash
   $ cd /etc/yum.repos.d/ && \
   sudo cp rocky-addons.repo rocky-addons.repo.bak && \
   sudo cp rocky-devel.repo rocky-devel.repo.bak && \
   sudo cp rocky-extras.repo rocky-extras.repo.bak && \
   sudo cp rocky.repo rocky.repo.bak && \
   sudo tar -zcvf Rocky.repo.bak.tar.gz rocky*.bak && \
   sudo rm -rf rocky*.bak
   ```

   2. æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›¿æ¢é»˜è®¤æº

   ```bash
   $ sudo sed -e 's|^mirrorlist=|#mirrorlist=|g' \
       -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g' \
       -i.bak \
       /etc/yum.repos.d/rocky*.repo
   ```

   3. åˆ é™¤sedäº§ç”Ÿçš„å¤‡ä»½æ–‡ä»¶

   ```bash
   $ sudo rm -rf rocky*.bak
   ```

5. æŸ¥çœ‹å¯ç”¨çš„yum

```bash
$ sudo dnf repolist all
```

4. ç¼“å­˜æœåŠ¡å™¨åŒ…ä¿¡æ¯ï¼Œä¹‹åé…åˆ`yum -C search xxx`å¯ç”¨ä¸ç”¨è”ç½‘å³å¯æ£€ç´¢è½¯ä»¶ä¿¡æ¯

```bash
# æ¸…ç†æ‰€æœ‰æ—§ç¼“å­˜
$ sudo dnf clean all
# ç”Ÿæˆæ–°ä»“åº“çš„å…ƒæ•°æ®ç¼“å­˜
$ sudo dnf makecache
```

### 2.4 å®‰è£…å¸¸ç”¨å‘½ä»¤

å®‰è£…ä¹‹å‰ï¼Œè¯·å…ˆä½¿ç”¨`whereis <cmd>`å‘½ä»¤æˆ–è€…`yum list <cmd>`å‘½ä»¤è¿›è¡Œæ£€æŸ¥ï¼Œæ˜¯å¦å·²ç»å®‰è£…ã€‚

```bash
# åœ¨å­Shellä¸­æ‰§è¡Œ
(
# å¯ç”¨ EPEL ç¬¬ä¸‰æ–¹è½¯ä»¶ä»“åº“
sudo dnf install -y epel-release
# æ¸…ç†æ—§å…ƒæ•°æ®å¹¶é‡å»ºæ–°ä»“åº“ç¼“å­˜ï¼ˆç¡®ä¿ EPEL åŒ…å¯è¢«å‘ç°ï¼‰
sudo dnf clean all && sudo dnf makecache
# å®‰è£…ç¼–è¾‘å™¨ã€Shell å¢å¼ºä¸åŸºç¡€å·¥å…·
sudo dnf install -y vim git curl wget bash-completion tree unzip tar psmisc
# å®‰è£…ç»ˆç«¯å¤ç”¨ã€æ–‡ä»¶åŒæ­¥ä¸è¿›ç¨‹/æ–‡ä»¶æŸ¥çœ‹å·¥å…·
sudo dnf install -y tmux rsync lsof
# å®‰è£…åŸºç¡€ç½‘ç»œè¯Šæ–­ä¸é…ç½®å·¥å…·ï¼ˆå«ä¼ ç»Ÿä¸ç°ä»£å‘½ä»¤ï¼‰
sudo dnf install -y net-tools iproute bind-utils socat nmap-ncat ethtool
# å®‰è£…é˜²ç«å¢™ã€è¿æ¥è·Ÿè¸ªä¸ç½‘ç»œç­–ç•¥ç®¡ç†å·¥å…·
sudo dnf install -y conntrack-tools ipset ebtables nftables
# å®‰è£…æ—¶é—´åŒæ­¥ã€å®¹å™¨è¿è¡Œæ—¶ä¸ SELinux ç®¡ç†å·¥å…·
sudo dnf install -y chrony policycoreutils-python-utils
# å®‰è£…ç³»ç»Ÿèµ„æºå®æ—¶ç›‘æ§å·¥å…·ï¼ˆCPU/å†…å­˜/ç£ç›˜/IO/ç½‘ç»œï¼‰
sudo dnf install -y htop glances ncdu iotop iftop sysstat smartmontools
# å®‰è£…ç½‘ç»œæŠ“åŒ…ã€æ‰«æã€è·¯ç”±è¿½è¸ªä¸å¸¦å®½æµ‹è¯•å·¥å…·
sudo dnf install -y tcpdump nmap mtr iperf3
# å®‰è£…å¼€å‘ç¼–è¯‘ä¸ç³»ç»Ÿè°ƒè¯•å·¥å…·
sudo dnf install -y gcc make jq yq strace skopeo
# å®‰è£…å‹ç¼©è§£å‹ã€ç£ç›˜æ€§èƒ½æµ‹è¯•ä¸åˆ†åŒºç®¡ç†å·¥å…·
sudo dnf install -y p7zip unrar fio parted gdisk
# å®¡è®¡æ—¥å¿—å·¥å…·ï¼ˆæ’æŸ¥å®‰å…¨äº‹ä»¶ï¼‰
sudo dnf install -y audit audit-libs

# === æ¸…ç†å®‰è£…ç¼“å­˜ä¸ä¸´æ—¶æ–‡ä»¶ï¼ˆæ„å»ºé˜¶æ®µï¼‰===
sudo dnf clean all
sudo rm -rf /var/log/dnf.* /var/log/yum.*
sudo rm -rf /tmp/* /var/tmp/*
sudo restorecon -R /tmp /var/tmp /var/log 2>/dev/null || true
)
```

::: details å„å‘½ä»¤/åŒ…åŠŸèƒ½ç®€è¿°

å½“ç„¶å¯ä»¥ï¼ä»¥ä¸‹æ˜¯å¯¹ä½ è„šæœ¬ä¸­ **æ¯ä¸ªè½¯ä»¶åŒ…** çš„**é€é¡¹è¯¦ç»†è¯´æ˜**ï¼ŒæŒ‰å®‰è£…é¡ºåºåˆ†ç»„ï¼Œæ¸…æ™°åˆ—å‡ºå…¶æ ¸å¿ƒç”¨é€”ï¼Œä¾¿äºä½ ç†è§£ä¸ºä½•éœ€è¦å®ƒã€‚

------

**ğŸ“¦ ç¬¬ä¸€ç»„ï¼šåŸºç¡€å·¥å…·**

| è½¯ä»¶åŒ…            | è¯¦ç»†ç”¨é€”                                                     |
| :---------------- | :----------------------------------------------------------- |
| `vim`             | å¼ºå¤§çš„å‘½ä»¤è¡Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆæ¯” vi åŠŸèƒ½æ›´ä¸°å¯Œï¼‰                   |
| `git`             | åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨äºä»£ç /é…ç½®ç®¡ç†                        |
| `curl`            | ä¼ è¾“æ•°æ®çš„å‘½ä»¤è¡Œå·¥å…·ï¼ˆæ”¯æŒ HTTP/HTTPS/FTP ç­‰ï¼Œå¸¸ç”¨äº API è°ƒç”¨ï¼‰ |
| `wget`            | ä»ç½‘ç»œä¸‹è½½æ–‡ä»¶ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œé€‚åˆæ‰¹é‡ä¸‹è½½ï¼‰                 |
| `bash-completion` | ä¸º Bash æä¾›æ™ºèƒ½ Tab è¡¥å…¨ï¼ˆå¦‚å‘½ä»¤ã€é€‰é¡¹ã€æ–‡ä»¶åè‡ªåŠ¨è¡¥å…¨ï¼‰    |
| `tree`            | ä»¥æ ‘çŠ¶å›¾å½¢å¼åˆ—å‡ºç›®å½•ç»“æ„ï¼Œä¾¿äºæŸ¥çœ‹æ–‡ä»¶å±‚çº§                   |
| `unzip`           | è§£å‹ `.zip` æ ¼å¼çš„å‹ç¼©æ–‡ä»¶                                   |
| `tar`             | æ‰“åŒ…å’Œè§£åŒ… `.tar`ã€`.tar.gz`ã€`.tar.xz` ç­‰å½’æ¡£æ–‡ä»¶ï¼ˆLinux æœ€å¸¸ç”¨ï¼‰ |
| `psmisc`          | åŒ…å« `pstree`ï¼ˆè¿›ç¨‹æ ‘ï¼‰ã€`killall`ï¼ˆæŒ‰åç§°æ€è¿›ç¨‹ï¼‰ç­‰å®ç”¨å·¥å…· |

------

**ğŸ“¦ ç¬¬äºŒç»„ï¼šç»ˆç«¯ä¸æ–‡ä»¶åŒæ­¥**
| è½¯ä»¶åŒ…  | è¯¦ç»†ç”¨é€”                                                     |
| :------ | :----------------------------------------------------------- |
| `tmux`  | ç»ˆç«¯å¤ç”¨å™¨ï¼šå¯åˆ›å»ºä¼šè¯ã€åˆ†å±ã€åå°è¿è¡Œä»»åŠ¡ï¼ˆSSH æ–­è¿ä¸ä¸­æ–­ï¼‰ |
| `rsync` | é«˜æ•ˆåŒæ­¥æ–‡ä»¶/ç›®å½•ï¼ˆå¢é‡ä¼ è¾“ï¼Œå¸¸ç”¨äºå¤‡ä»½æˆ–éƒ¨ç½²ï¼‰              |
| `lsof`  | åˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç½‘ç»œè¿æ¥ã€è®¾å¤‡ã€æ™®é€šæ–‡ä»¶ï¼‰ï¼Œæ’æŸ¥â€œæ–‡ä»¶è¢«å ç”¨â€é—®é¢˜ |

------

**ğŸ“¦ ç¬¬ä¸‰ç»„ï¼šç½‘ç»œè¯Šæ–­ï¼ˆä¼ ç»Ÿ + ç°ä»£ï¼‰**

| è½¯ä»¶åŒ…       | è¯¦ç»†ç”¨é€”                                                     |
| :----------- | :----------------------------------------------------------- |
| `net-tools`  | ä¼ ç»Ÿç½‘ç»œå·¥å…·åŒ…ï¼šåŒ…å« `ifconfig`, `netstat`, `route`ï¼ˆå·²é€æ­¥è¢« `ip` æ›¿ä»£ï¼Œä½†å…¼å®¹æ—§è„šæœ¬ï¼‰ |
| `iproute`    | ç°ä»£ç½‘ç»œå·¥å…·åŒ…ï¼šæä¾› `ip`ï¼ˆæ›¿ä»£ ifconfig/routeï¼‰ã€`ss`ï¼ˆæ›¿ä»£ netstatï¼‰ç­‰ |
| `bind-utils` | DNS æŸ¥è¯¢å·¥å…·ï¼š`nslookup`, `dig`, `host`ï¼ˆæ’æŸ¥åŸŸåè§£æé—®é¢˜ï¼‰  |
| `socat`      | â€œç½‘ç»œç‘å£«å†›åˆ€â€ï¼šåŒå‘æ•°æ®è½¬å‘ï¼ˆTCP/UDP/Unix socket ç­‰ï¼‰ï¼Œæ¯” `nc` æ›´å¼ºå¤§ |
| `nmap-ncat`  | `ncat` æ˜¯ Nmap é¡¹ç›®ä¸‹çš„å¢å¼ºç‰ˆ `netcat`ï¼Œç”¨äºç«¯å£æ‰«æã€ç›‘å¬ã€ä»£ç†ç­‰ |
| `ethtool`    | æŸ¥çœ‹/é…ç½®ç½‘å¡å‚æ•°ï¼ˆå¦‚é€Ÿç‡ã€åŒå·¥ã€é©±åŠ¨ä¿¡æ¯ï¼‰                  |

------

**ğŸ“¦ ç¬¬å››ç»„ï¼šé˜²ç«å¢™ä¸ç½‘ç»œç­–ç•¥**

| è½¯ä»¶åŒ…            | è¯¦ç»†ç”¨é€”                                                     |
| :---------------- | :----------------------------------------------------------- |
| `conntrack-tools` | ç®¡ç†å†…æ ¸è¿æ¥è·Ÿè¸ªè¡¨ï¼ˆ`conntrack` å‘½ä»¤ï¼‰ï¼Œå¸¸ç”¨äºæ’æŸ¥ NAT æˆ–å®¹å™¨ç½‘ç»œé—®é¢˜ |
| `ipset`           | é«˜æ•ˆ IP åœ°å€é›†åˆç®¡ç†ï¼ˆé…åˆ iptables/nftables å®ç°å¤§æ‰¹é‡ IP è§„åˆ™ï¼‰ |
| `ebtables`        | ç®¡ç†ä»¥å¤ªç½‘æ¡¥æ¥å±‚çš„è¿‡æ»¤è§„åˆ™ï¼ˆç”¨äºè™šæ‹ŸåŒ–/å®¹å™¨ç½‘ç»œåº•å±‚æ§åˆ¶ï¼‰    |
| `nftables`        | æ–°ä¸€ä»£ Linux åŒ…è¿‡æ»¤æ¡†æ¶ï¼ˆæ›¿ä»£ iptablesï¼‰ï¼Œè¯­æ³•æ›´ç®€æ´ã€æ€§èƒ½æ›´é«˜ |

------

**ğŸ“¦ ç¬¬äº”ç»„ï¼šç³»ç»ŸæœåŠ¡ä¸å®‰å…¨**

| è½¯ä»¶åŒ…                         | è¯¦ç»†ç”¨é€”                                                     |
| :----------------------------- | :----------------------------------------------------------- |
| `chrony`                       | é«˜ç²¾åº¦æ—¶é—´åŒæ­¥æœåŠ¡ï¼ˆæ¯” ntpd æ›´é€‚åˆè™šæ‹Ÿæœºå’Œé—´æ­‡æ€§è”ç½‘ç¯å¢ƒï¼‰   |
| `policycoreutils-python-utils` | SELinux ç®¡ç†å·¥å…·ï¼ˆåŒ…å« `semanage`ï¼Œç”¨äºä¿®æ”¹æ–‡ä»¶/ç«¯å£å®‰å…¨ä¸Šä¸‹æ–‡ï¼‰ |

------

**ğŸ“¦ ç¬¬å…­ç»„ï¼šç³»ç»Ÿç›‘æ§**

| è½¯ä»¶åŒ…                                                       | è¯¦ç»†ç”¨é€”                                                     |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| `htop`                                                       | äº¤äº’å¼è¿›ç¨‹æŸ¥çœ‹å™¨ï¼ˆæ¯” top æ›´ç›´è§‚ï¼Œæ”¯æŒé¼ æ ‡ã€é¢œè‰²ã€æ ‘çŠ¶è§†å›¾ï¼‰  |
| `glances`                                                    | å…¨èƒ½ç³»ç»Ÿç›‘æ§å·¥å…·ï¼ˆCPU/å†…å­˜/ç£ç›˜/ç½‘ç»œ/è¿›ç¨‹/ä¼ æ„Ÿå™¨ç­‰ä¸€ä½“åŒ–å±•ç¤ºï¼‰ |
| `ncdu`                                                       | ç£ç›˜ä½¿ç”¨åˆ†æå™¨ï¼ˆäº¤äº’å¼æŸ¥çœ‹å¤§æ–‡ä»¶/ç›®å½•ï¼Œç±»ä¼¼ `du -sh *` çš„å‡çº§ç‰ˆï¼‰ |
| `iotop`                                                      | å®æ—¶ç›‘æ§ç£ç›˜ I/O ä½¿ç”¨æƒ…å†µï¼ˆæ‰¾å‡ºé«˜ IO è¿›ç¨‹ï¼‰                  |
| `iftop`                                                      | å®æ—¶ç›‘æ§ç½‘ç»œå¸¦å®½ä½¿ç”¨ï¼ˆæŒ‰è¿æ¥æ˜¾ç¤ºæµé‡ï¼Œç±»ä¼¼ top for networkï¼‰ |
| <span style="color:#32CD32;font-weight:bold;">`sysstat`</span> | åŒ…å« `sar`ã€`iostat`ã€`mpstat` ç­‰ï¼Œç”¨äºå†å²æ€§èƒ½æ•°æ®é‡‡é›†ä¸åˆ†æï¼ˆä¼šå¢åŠ sysstat.serviceæœåŠ¡ï¼‰ |
| <span style="color:#32CD32;font-weight:bold;">`smartmontools`</span> | è¯»å–ç¡¬ç›˜ SMART ä¿¡æ¯ï¼ˆé¢„æµ‹ç£ç›˜æ•…éšœï¼Œæ£€æŸ¥å¥åº·çŠ¶æ€ï¼‰            |

------

ğŸ“¦ ç¬¬ä¸ƒç»„ï¼šç½‘ç»œæµ‹è¯•

| è½¯ä»¶åŒ…    | è¯¦ç»†ç”¨é€”                                                     |
| :-------- | :----------------------------------------------------------- |
| `tcpdump` | æŠ“å–ç½‘ç»œæ•°æ®åŒ…ï¼ˆç”¨äºæ·±åº¦åˆ†æåè®®ã€æ’æŸ¥è¿æ¥é—®é¢˜ï¼‰             |
| `nmap`    | ç½‘ç»œå‘ç°ä¸å®‰å…¨æ‰«æå·¥å…·ï¼ˆä¸»æœºå‘ç°ã€ç«¯å£æ‰«æã€æœåŠ¡è¯†åˆ«ï¼‰       |
| `mtr`     | ç»“åˆ `ping` å’Œ `traceroute` çš„ç½‘ç»œè¯Šæ–­å·¥å…·ï¼ˆå®æ—¶æ˜¾ç¤ºè·¯ç”±è·¯å¾„å’Œå»¶è¿Ÿï¼‰ |
| `iperf3`  | ç½‘ç»œå¸¦å®½æ€§èƒ½æµ‹è¯•ï¼ˆæµ‹é‡ TCP/UDP ååé‡ï¼ŒéªŒè¯é“¾è·¯è´¨é‡ï¼‰        |

------

ğŸ“¦ ç¬¬å…«ç»„ï¼šå¼€å‘ä¸è°ƒè¯•

| è½¯ä»¶åŒ…   | è¯¦ç»†ç”¨é€”                                                     |
| :------- | :----------------------------------------------------------- |
| `gcc`    | GNU C/C++ ç¼–è¯‘å™¨ï¼ˆç¼–è¯‘æºç ã€å®‰è£…æŸäº› Python/Ruby æ‰©å±•å¿…éœ€ï¼‰  |
| `make`   | è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼ˆæ ¹æ® Makefile ç¼–è¯‘é¡¹ç›®ï¼‰                     |
| `jq`     | å‘½ä»¤è¡Œ JSON å¤„ç†å™¨ï¼ˆè§£æã€è¿‡æ»¤ã€æ ¼å¼åŒ– JSONï¼Œè„šæœ¬ä¸­æå¸¸ç”¨ï¼‰  |
| `yq`     | å‘½ä»¤è¡Œ YAML å¤„ç†å™¨ï¼ˆè§£æã€è¿‡æ»¤ã€æ ¼å¼åŒ–YAMLï¼Œè„šæœ¬ä¸­æå¸¸ç”¨ï¼‰   |
| `strace` | è·Ÿè¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨å’Œä¿¡å·ï¼ˆè°ƒè¯•ç¨‹åºå´©æºƒã€æƒé™é—®é¢˜ç­‰ï¼‰         |
| skopeo   | **è½»é‡çº§ã€æ— éœ€ rootã€æ— éœ€å®ˆæŠ¤è¿›ç¨‹**çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸“é—¨ç”¨äº**æ“ä½œå’Œç®¡ç†å®¹å™¨é•œåƒï¼ˆContainer Imagesï¼‰** â€”â€” è€Œä¸”**ä¸éœ€è¦å…ˆæ‹‰å–æ•´ä¸ªé•œåƒåˆ°æœ¬åœ°**ï¼ |

------

**ğŸ“¦ ç¬¬ä¹ç»„ï¼šå­˜å‚¨ä¸åˆ†åŒº**

| è½¯ä»¶åŒ…   | è¯¦ç»†ç”¨é€”                                                     |
| :------- | :----------------------------------------------------------- |
| `p7zip`  | æ”¯æŒ `.7z` æ ¼å¼çš„é«˜å‹ç¼©ç‡è§£å‹å·¥å…·                            |
| `unrar`  | è§£å‹ `.rar` æ ¼å¼æ–‡ä»¶ï¼ˆå¸¸è§äº Windows å…±äº«æ–‡ä»¶ï¼‰              |
| `fio`    | çµæ´»çš„ç£ç›˜ I/O æ€§èƒ½æµ‹è¯•å·¥å…·ï¼ˆæ¨¡æ‹Ÿéšæœº/é¡ºåºè¯»å†™ï¼Œè¯„ä¼°å­˜å‚¨æ€§èƒ½ï¼‰ |
| `parted` | å‘½ä»¤è¡Œåˆ†åŒºå·¥å…·ï¼ˆæ”¯æŒå¤§äº 2TB çš„ç£ç›˜ï¼Œæ“ä½œ MBR åˆ†åŒºè¡¨ï¼‰       |
| `gdisk`  | GPT åˆ†åŒºè¡¨ä¸“ç”¨å·¥å…·ï¼ˆç”¨äº UEFI ç³»ç»Ÿçš„å¤§å®¹é‡ç£ç›˜åˆ†åŒºï¼‰         |

**ğŸ“¦ ç¬¬åç»„ï¼šå®¡è®¡æ—¥å¿—å·¥å…·**

| è½¯ä»¶åŒ…       | è¯¦ç»†ç”¨é€”                                                     |
| :----------- | :----------------------------------------------------------- |
| `audit`      | è®°å½•ç³»ç»Ÿå®‰å…¨ç›¸å…³äº‹ä»¶ï¼ˆå¦‚æ–‡ä»¶è®¿é—®ã€æƒé™å˜æ›´ã€ç³»ç»Ÿè°ƒç”¨ç­‰ï¼‰     |
| `audit-libs` | æä¾›å®¡è®¡åŠŸèƒ½æ‰€éœ€çš„å…±äº«åº“ï¼Œä¾›åº”ç”¨ç¨‹åºå’Œå†…æ ¸æ¨¡å—ä¸å®¡è®¡å­ç³»ç»Ÿäº¤äº’ã€‚ |

------

âœ… **æ€»ç»“**ï¼š
è½¯ä»¶åŒ…è¦†ç›–äº† **è¿ç»´ã€å¼€å‘ã€ç½‘ç»œã€å®‰å…¨ã€ç›‘æ§ã€å­˜å‚¨** å…­å¤§æ ¸å¿ƒåœºæ™¯ï¼Œ**æ— å†—ä½™ã€æ—  GUI ä¾èµ–**ï¼Œéå¸¸é€‚åˆæ„å»ºä¸€ä¸ª**è½»é‡ä½†åŠŸèƒ½å®Œå¤‡**çš„ Linux åŸºç¡€é•œåƒã€‚

:::

### 2.5 é…ç½®å…¬ç½‘DNSè§£æ

- éªŒè¯æ˜¯å¦éœ€è¦é…ç½®å…¬ç½‘DNS

```bash
# æµ‹è¯•å½“å‰dnsèƒ½å¦è§£æ
$ nslookup registry.cn-beijing.aliyuncs.com|grep Server|awk '{print $2}'|xargs -I {} dig @{} registry.cn-beijing.aliyuncs.com +short
```

```bash
# æ— æ³•è§£æçš„ç»“æœ
;; Warning: Message parser reports malformed message packet.
10 8 VpBQqM8S8rk=
# æ­£å¸¸è§£æçš„ç»“æœ
47.95.181.38
```

- é…ç½®å…¬ç½‘DNS

```bash
# 1. æŸ¥çœ‹å½“å‰ IP é…ç½®æ–¹å¼
CURRENT_METHOD=$(nmcli -g ipv4.method con show eth0)
echo "å½“å‰ IP é…ç½®æ–¹å¼: $CURRENT_METHOD"

# 2. ç¦ç”¨è‡ªåŠ¨ DNSï¼ˆé€‚ç”¨äº DHCP å’Œé™æ€ IPï¼‰
sudo nmcli con mod eth0 ipv4.ignore-auto-dns yes

# 3. è®¾ç½®å¯é  DNSï¼ˆå›½å†…ä¼˜å…ˆä½¿ç”¨é˜¿é‡Œäº‘DNSï¼‰
sudo nmcli con mod eth0 ipv4.dns "223.5.5.5,223.6.6.6"
# sudo nmcli con mod eth0 ipv4.dns "114.114.114.114,8.8.8.8"

# 4. å¦‚æœæ˜¯é™æ€ IPï¼Œç¡®ä¿ method ä¸º manualï¼ˆå¯é€‰ä½†æ¨èï¼‰
if [ "$CURRENT_METHOD" = "manual" ]; then
    echo "æ£€æµ‹åˆ°é™æ€ IPï¼Œä¿æŒ method=manual"
    # å¯åœ¨æ­¤è¡¥å…… addresses/gatewayï¼ˆå¦‚æœå°šæœªé…ç½®ï¼‰
fi

# 5. é‡å¯è¿æ¥ç”Ÿæ•ˆ
sudo nmcli con down eth0 && sudo nmcli con up eth0
```

## 3 é•œåƒå°å­˜ä¸é“¾æ¥å…‹éš†

### 3.1 é•œåƒå°å­˜

```bash
sudo tee /usr/local/bin/seal-template.sh > /dev/null <<'EOF'
#!/bin/bash
set -euo pipefail

echo "â„¹ï¸  Cleaning up for snapshot (requires sudo)..."

# æ¸…ç†åŒ…ç¼“å­˜
sudo dnf clean all 2>/dev/null || sudo yum clean all 2>/dev/null || true

# å¸è½½æŒ‚è½½ç‚¹
for mnt in /mnt/hgfs /mnt/localrepo; do
    if mountpoint -q " $ mnt" 2>/dev/null; then
        sudo umount -l " $ mnt" 2>/dev/null || true
    fi
done

# åœæ­¢ automount æœåŠ¡
sudo systemctl stop mnt-hgfs.service mnt-localrepo.automount 2>/dev/null || true

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—
sudo find /tmp -mindepth 1 -delete 2>/dev/null || true # æ¸…ç†ä¸´æ—¶ç›®å½•ï¼ˆå®‰å…¨æ–¹å¼ï¼‰
sudo find /var/tmp -mindepth 1 -delete 2>/dev/null || true
sudo journalctl --vacuum-size=1M 2>/dev/null || true # æ¸…ç† systemd journal
sudo find /var/log -type f -exec truncate -s 0 {} \; 2>/dev/null || true # æ¸…ç©ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼ˆä¿ç•™ç›®å½•ç»“æ„ï¼‰
sudo find /var/log -type f   $  -name "*.gz" -o -name "*.bz2" -o -name "*.old" -o -name "*.?[0-9]"  $   -delete 2>/dev/null || true # åˆ é™¤å‹ç¼©/è½®è½¬çš„æ—¥å¿—

# === æ¸…ç†å¹¶ç¦ç”¨ swapï¼ˆä»…ç”¨äºå¿«ç…§ï¼Œä¸å½±å“åŸå§‹é•œåƒé…ç½®ï¼‰===
if command -v swapon >/dev/null 2>&1 && swapon --show > /dev/null 2>&1; then
    echo "ğŸ§¹ Disabling and wiping swap..."
    sudo swapoff -a
    while IFS= read -r line; do
        NAME=$(echo "$line" | awk '{print $1}')
        TYPE=$(echo "$line" | awk '{print $2}')
        if [ "$TYPE" = "partition" ]; then
            sudo dd if=/dev/zero of="$NAME" bs=1M status=none 2>/dev/null
        elif [ "$TYPE" = "file" ]; then
            sudo rm -f "$NAME"
        fi
    done < <(swapon --show=NAME,TYPE --noheadings 2>/dev/null)
fi

# === å½’é›¶ç©ºé—²ç©ºé—´ï¼ˆç”¨äºç²¾ç®€ç£ç›˜å‹ç¼©ï¼‰===
echo "ğŸª„ Zeroing free space (for thin disk optimization)..."
FREE_BLOCKS=$(df / | awk 'NR==2 {print $4}')
if [ "$FREE_BLOCKS" -gt 0 ]; then
    FREE_MB=$((FREE_BLOCKS / 1024))
    WRITE_MB=$((FREE_MB * 95 / 100))
    [ $WRITE_MB -gt 4096 ] && WRITE_MB=4096
    [ $WRITE_MB -gt 0 ] && {
        # å½’é›¶ç£ç›˜ç©ºé—²ç©ºé—´ï¼ˆå…³é”®ï¼ä¾¿äº VMware ç²¾ç®€ç£ç›˜ï¼‰
        sudo dd if=/dev/zero of=/EMPTY bs=1M count=$WRITE_MB status=none 2>/dev/null
        sudo sync # ç¡®ä¿æ•°æ®çœŸæ­£å†™å…¥ç£ç›˜å†åˆ é™¤
        sudo rm -f /EMPTY # åˆ é™¤å½’é›¶æ–‡ä»¶
    }
fi

echo ""
echo "âœ… Cleanup done."

# Ask for poweroff
read -r -p "Would you like to power off now? [Y/n]: " response
case "${response:-Y}" in
    [yY][eE][sS]|[yY]|"")
        echo "ğŸ›‘ Powering off..."
        sudo systemctl poweroff
        ;;
    *)
        echo "â„¹ï¸  Skipping poweroff. Remember to shut down before taking the VM snapshot!"
        ;;
esac
EOF

sudo chmod +x /usr/local/bin/seal-template.sh

echo "ğŸ”§ ä½¿ç”¨æ–¹æ³•ï¼š"
echo "è¯´æ˜ï¼šå¿«ç…§å‰æ¸…ç†: /usr/local/bin/seal-template.sh"
```

### 3.2 é“¾æ¥å…‹éš†

```bash
sudo tee /usr/local/bin/unseal-template.sh > /dev/null <<'EOF'
#!/bin/bash
set -euo pipefail

echo "ğŸ”§ Running first-boot cleanup for linked clone (requires sudo)..."

# Reset machine-id properly
if command -v systemd-machine-id-setup >/dev/null 2>&1; then
    # æ¸…ç©ºå†…å®¹ï¼ˆæ¯”åˆ é™¤æ›´å®‰å…¨ï¼Œé¿å…ç›®å½•ç¼ºå¤±ç­‰é—®é¢˜ï¼‰
    sudo truncate -s 0 /etc/machine-id 2>/dev/null || sudo touch /etc/machine-id
    sudo systemd-machine-id-setup
    # Ensure dbus symlink
    sudo ln -sf /etc/machine-id /var/lib/dbus/machine-id 2>/dev/null || true
else
    # Fallback for non-systemd systems (unlikely on Rocky 9)
    sudo truncate -s 0 /etc/machine-id 2>/dev/null || sudo touch /etc/machine-id
    sudo ln -sf /etc/machine-id /var/lib/dbus/machine-id 2>/dev/null || true
fi

# Regenerate SSH host keys
if sudo test -d /etc/ssh 2>/dev/null; then
    sudo rm -f /etc/ssh/ssh_host_*_key* 2>/dev/null || true
    if ! sudo ssh-keygen -A -q 2>/dev/null; then
        sudo ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N "" -q
        sudo ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N "" -q
        sudo ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N "" -q
    fi
fi

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—
sudo find /tmp -mindepth 1 -delete 2>/dev/null || true # æ¸…ç†ä¸´æ—¶ç›®å½•ï¼ˆå®‰å…¨æ–¹å¼ï¼‰
sudo find /var/tmp -mindepth 1 -delete 2>/dev/null || true
sudo journalctl --vacuum-size=1M 2>/dev/null || true # æ¸…ç† systemd journal
sudo find /var/log -type f -exec truncate -s 0 {} \; 2>/dev/null || true # æ¸…ç©ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼ˆä¿ç•™ç›®å½•ç»“æ„ï¼‰
sudo find /var/log -type f   $  -name "*.gz" -o -name "*.bz2" -o -name "*.old" -o -name "*.?[0-9]"  $   -delete 2>/dev/null || true # åˆ é™¤å‹ç¼©/è½®è½¬çš„æ—¥å¿—

# Self-destruct
sudo rm -f -- "$0" 2>/dev/null || true

echo ""
echo "âœ… Cleanup complete! This VM is now unique."

# Ask for reboot
read -r -p "Would you like to reboot now? [Y/n]: " response
case "${response:-Y}" in
    [yY][eE][sS]|[yY]|"")
        echo "ğŸ” Rebooting..."
        sudo systemctl reboot
        ;;
    *)
        echo "â„¹ï¸  Skipping reboot. Remember to restart later if needed."
        ;;
esac
EOF

sudo chmod +x /usr/local/bin/unseal-template.sh

echo "ğŸ”§ ä½¿ç”¨æ–¹æ³•ï¼š"
echo "è¯´æ˜ï¼šå…‹éš†åé¦–æ¬¡å¯åŠ¨: sudo /usr/local/bin/unseal-template.sh"
```

## 9 ç‰¹æ®Šé—®é¢˜

### 9.0 å…³äºè½¯ä»¶ç«¯å£è®¿é—®çš„è¯´æ˜

â€‹	å…³äºè½¯ä»¶ç«¯å£è®¿é—®ï¼Œå¦‚æœé˜²ç«å¢™å¼€å¯(`systemctl start firewalld`)ï¼Œä¸”éœ€è¦å¤–éƒ¨ç¯å¢ƒè®¿é—®ï¼Œé‚£ä¹ˆå¯ä»¥å¼€æ”¾ç«¯å£(`firewalld-cmd`å‘½ä»¤)ï¼Œå¦‚æœä¸éœ€è¦å¤–éƒ¨è®¿é—®ï¼Œåªéœ€è¦åœ¨æœ¬æœºå†…è®¿é—®ï¼Œé€šè¿‡`127.0.0.1`æ–¹å¼è®¿é—®å³å¯ã€‚å¦‚æœé˜²ç«å¢™å…³é—­(`systemctl stop firewalld`)ï¼Œé‚£ä¹ˆå¤–éƒ¨ä¸æœ¬æœºéƒ½å¯ä»¥ç›´æ¥é€šè¿‡IPåœ°å€è®¿é—®ã€‚

â€‹	åœ¨æœ¬æ–‡ä»¥ä¸‹çš„å®‰è£…ä¸­ï¼Œé»˜è®¤æ˜¯é˜²ç«å¢™å¼€å¯çŠ¶æ€ï¼Œä¸”éœ€è¦å¤–éƒ¨é€šè¿‡IPåœ°å€è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å¼€æ”¾ç«¯å£çš„è½¯ä»¶ï¼Œä¼šå¼€æ”¾ç«¯å£ã€‚æ¯”å¦‚vsftpdçš„21ç«¯å£ï¼ŒNginxçš„80ç«¯å£ç­‰ç­‰ã€‚

### 9.1 è™šæ‹ŸæœºæŒ‚èµ·åæ¢å¤æ— æ³•ç™»å½•

- è¡¨è±¡

è™šæ‹ŸæœºæŒ‚èµ·æ¢å¤åï¼Œåœ¨è™šæ‹ŸæœºçœŸå®ç»ˆç«¯æ— æ³•ç™»å½•ï¼Œå›è½¦ä¹Ÿæ— ååº”ï¼Œä½†ä¼ªç»ˆç«¯å¯ä»¥sshè®¿é—®æ—¶ã€‚

<img src="./images/image-20260115132208029.png" alt="image-20260115132208029" style="zoom:50%;" />

- ä¸´æ—¶è§£å†³

```bash
# æŸ¥çœ‹å“ªäº›gettyæœåŠ¡è¢«å¯ç”¨
$ sudo systemctl list-units | grep getty 
# è¾“å‡º
  getty@tty1.service                                                                               loaded active     running   Getty on tty1
  system-getty.slice                                                                               loaded active     active    Slice /system/getty
  getty.target                                                                                     loaded active     active    Login Prompts
# é‡å¯tty1çš„gettyæœåŠ¡å³å¯è§£å†³
$ sudo systemctl restart getty@tty1
```

- æ°¸ä¹…è§£å†³

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œè®¾ç½®å†…æ ¸åªè¾“å‡ºä¸¥é‡é”™è¯¯åˆ° console
sudo tee /etc/sysctl.d/99-quiet-console.conf <<'EOF'
# Reduce kernel messages on console (avoid spam during VM resume)
kernel.printk = 3 4 1 7
EOF

# ç«‹å³åº”ç”¨
sudo sysctl -p /etc/sysctl.d/99-quiet-console.conf
```

### 9.2 å¦‚ä½•é…ç½®æœ¬åœ°DNSè§£æ

#### 9.2.1 é…ç½®æœ¬åœ°DNSè§£æ

æ‰“å¼€æ–‡ä»¶åï¼Œåœ¨æœ€åä¸€è¡Œè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
$ sudo vim /etc/hosts
```

```bash
192.168.200.116   wenqiu
```

#### 9.2.2 é…ç½®å…¬ç½‘DNSè§£æ

```bash
$ sudo vim /etc/resolv.conf
```

```bash
# ä¸»DNSï¼šVMwareç½‘å…³ï¼ˆç»§æ‰¿å®¿ä¸»æœºè®¾ç½®ï¼‰
nameserver 192.168.200.2

# å¤‡ç”¨DNSï¼šå…¬å…±DNSï¼ˆé˜²æ­¢ç½‘å…³æ•…éšœï¼‰
nameserver 114.114.114.114
nameserver 8.8.8.8
```

- ä¸¤ç§é…ç½®çš„å¯¹æ¯”åˆ†æ

| **é…ç½®æ–¹æ¡ˆ**                 | ä¼˜ç‚¹                                                         | ç¼ºç‚¹                                                     | é€‚ç”¨åœºæ™¯                   |
| :--------------------------- | :----------------------------------------------------------- | :------------------------------------------------------- | :------------------------- |
| `nameserver 192.168.200.2`   | 1. è‡ªåŠ¨ç»§æ‰¿å®¿ä¸»æœº DNS è®¾ç½® 2. æ”¯æŒå†…ç½‘åŸŸåè§£æ 3. å¯è®¿é—®å®¿ä¸»æœº VPN çš„å†…éƒ¨èµ„æº | ä¾èµ– VMware NAT æœåŠ¡çš„ç¨³å®šæ€§                             | **æ¨èä½œä¸ºé¦–é€‰æ–¹æ¡ˆ**       |
| `nameserver 114.114.114.114` | 1. ä¸ä¾èµ–å®¿ä¸»æœºç½‘ç»œ 2. ç›´æ¥å…¬ç½‘è§£æ                          | 1. æ— æ³•è§£æå†…ç½‘èµ„æº 2. å®¿ä¸»æœº VPN å¤±æ•ˆæ—¶æ— æ³•è®¿é—®å†…éƒ¨ç³»ç»Ÿ | å®¿ä¸»æœºç½‘ç»œå¼‚å¸¸æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ |

- ä¸ºä»€ä¹ˆ `192.168.200.2` æ›´åˆé€‚ï¼Ÿ

```mermaid
graph LR
    A[è™šæ‹Ÿæœº] --> B[VMnet8ç½‘å…³ 192.168.200.2]
    B --> C[å®¿ä¸»æœº 192.168.200.1]
    C --> D[ç‰©ç†è·¯ç”±å™¨]
    D --> E[äº’è”ç½‘]
```

### 9.3 å¦‚ä½•é…ç½®æœåŠ¡å™¨æ—¶åŒº

- æŸ¥è¯¢æœåŠ¡å™¨æ—¶åŒº

```bash
$ timedatectl
               Local time: äº” 2025-07-11 10:22:14 CST
           Universal time: äº” 2025-07-11 02:22:14 UTC
                 RTC time: äº” 2025-07-11 02:22:15
                Time zone: Asia/Shanghai (CST, +0800)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```

- é…ç½®æœåŠ¡å™¨æ—¶åŒºä¸º **Asia/Shanghai**ã€‚

```bash
$ timedatectl set-timezone Asia/Shanghai
```

### 9.4 Rocky9æ—¶é—´åŒæ­¥é—®é¢˜ï¼ˆé’ˆå¯¹è™šæ‹Ÿæœºåœºæ™¯ï¼‰

<span style="color:red;font-weight:bold;">Rocky Linux 9 é»˜è®¤ä½¿ç”¨ `chrony` ä½œä¸º NTP å®¢æˆ·ç«¯ï¼Œè‹¥å‘ç°æ¢å¤å¿«ç…§åï¼Œæˆ–MacOSæ¢å¤å·¥ä½œçŠ¶æ€åï¼Œè™šæ‹Ÿæœºç³»ç»Ÿæ—¶é’Ÿä¸åŒæ­¥ï¼Œè¡¨ç°ä¸ºï¼š</span>

```bash {6}
$ timedatectl 
               Local time: å›› 2025-05-29 15:00:27 CST
           Universal time: å›› 2025-05-29 07:00:27 UTC
                 RTC time: äº” 2025-05-30 22:36:01
                Time zone: Asia/Shanghai (CST, +0800)
System clock synchronized: no
              NTP service: active
          RTC in local TZ: no
```

`timedatectl` æ˜¾ç¤º `System clock synchronized: no`ï¼Œå³ä½¿ NTP æœåŠ¡æ˜¯ active çŠ¶æ€ã€‚è¿™æ˜¯å› ä¸ºæ¢å¤å¿«ç…§åæ—¶é—´åå·®å¤ªå¤§ï¼Œchronyd æœåŠ¡ä¸ä¼šè‡ªåŠ¨å¤§å¹…è°ƒæ•´æ—¶é—´ï¼ˆå‡ºäºå®‰å…¨è€ƒè™‘ï¼‰ã€‚

- å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡

```bash
$ sudo systemctl enable --now vmtoolsd
```

[é…ç½®æ—¶é—´åŒæ­¥](http://localhost:8751/devops/new/Linux/05-%E7%AC%AC5%E7%AB%A0%20%E5%AE%9E%E7%94%A8%E6%8C%87%E4%BB%A4.html#_4-4-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1)

### 9.5 å¦‚ä½•ä¿®æ”¹ä¸»æœºå

- ç¬¬ä¸€æ­¥

```bash
$ sudo hostnamectl set-hostname wenqiu
```

- ç¬¬äºŒæ­¥ï¼šéªŒè¯

```bash
$ sudo cat /etc/hostname
wenqiu
$ sudo hostname
wenqiu
```

- ç¬¬ä¸‰æ­¥ï¼šé…ç½®

```bash
$ sudo vim /etc/hosts
```

```bash
# è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯æŸä¸ªå…·ä½“çš„IPåœ°å€
192.168.200.116	wenqiu
```

- ç¬¬å››éƒ¨ï¼šé€€å‡ºShellï¼Œé‡æ–°ç™»å½•å³å¯

### 9.6 å¦‚ä½•é…ç½®ç½‘ç»œ

```bash
# ä¸€æ¡å‘½ä»¤å†™å®Œæ‰€æœ‰é…ç½®ã€æ¨èã€‘
$ sudo nmcli conn add type ethernet ifname enp2s0 con-name enp2s0 \
    ipv4.addresses 192.168.200.116/24 \
    ipv4.gateway 192.168.200.2 \
    ipv4.dns 192.168.200.2 \
    ipv4.method manual \
    autoconnect yes
```

### 9.7 å¦‚ä½•åˆ›å»ºå…·æœ‰sudoæƒé™çš„æ™®é€šç”¨æˆ·

0. æµ‹è¯•æ˜¯å¦å¯ä»¥ä½¿ç”¨sudo

```bash
# è¾“å‡ºrootè¡¨ç¤ºå¯ä»¥ï¼›xxx is not in the sudoers file. This incident will be reported. è¡¨ç¤ºä¸å¯ä»¥
$ sudo whoami
```

1. åˆ›å»ºæ™®é€šç”¨æˆ·

```bash
$ sudo useradd -c "Web Site User" emon
```

2. ä¿®æ”¹å¯†ç 

```bash
$ sudo passwd emon
```

3. èµ‹æƒsudo

   1. æ–¹æ¡ˆä¸€ï¼šé…ç½®`visudo`

   rootç”¨æˆ·ä»¥`visudo`å‘½ä»¤æ‰“å¼€æ–‡ä»¶ï¼Œæ‰¾åˆ°`## Allow root to run any commands anywhere`ï¼Œåœ¨ä¹‹åè¿½åŠ ï¼š

   ```bash
   $ sudo visudo
   ## Allow root to run any commands anywhere
   root    ALL=(ALL)       ALL
   emon    ALL=(ALL)       ALL
   ```

   2. æ–¹æ¡ˆäºŒï¼šæ·»åŠ åˆ°wheelç»„

   Rocky Linux é»˜è®¤å¯ç”¨äº†ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„æœºåˆ¶ï¼š

   > **ä»»ä½•å±äº `wheel` ç»„çš„ç”¨æˆ·ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ `sudo`**
   >
   > è¿™æ˜¯ç”± `/etc/sudoer` æ–‡ä»¶ä¸­çš„é…ç½®å¯ç”¨çš„ã€‚
   >
   > ```bash
   > ## Allows people in group wheel to run all commands
   > %wheel  ALL=(ALL)       ALL
   > ```

   æ‰€ä»¥ï¼Œæœ€ç®€å•çš„æ–¹æ³•ä¸æ˜¯æ”¹ sudoersï¼Œè€Œæ˜¯ï¼š

   ```bash
   # å°†ç”¨æˆ·åŠ å…¥ wheel ç»„
   sudo usermod -aG wheel ä½ çš„ç”¨æˆ·å
   ```

### 9.8 CentOS7é…ç½®æœ¬åœ°yumæº

å¦‚æœæœ¬åœ°å®‰è£…äº†Git Bashï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨scpå‘½ä»¤ï¼Œä½¿ç”¨scpä¼ è¾“åˆ°ç³»ç»Ÿçš„`/usr/local/src`ç›®å½•å³å¯ã€‚

å¦‚æœæœ¬åœ°æ²¡æœ‰å®‰è£…Git Bashï¼Œæˆ–è€…æ— æ³•ä½¿ç”¨scpå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨xftpä¼ è¾“åˆ°ç³»ç»Ÿçš„`/usr/local/src`ç›®å½•ã€‚

1. åŸºäºæœ¬åœ°æ–‡ä»¶åˆ›å»ºyumæº

:::details è¯¦æƒ…

```bash
# åœ¨å­Shellä¸­æ‰§è¡Œ
(
#!/bin/bash

# å®šä¹‰å˜é‡ï¼ˆä¾¿äºç»´æŠ¤ï¼‰
ISO_PATH="/usr/local/src/CentOS-7-x86_64-DVD-2009.iso"
MOUNT_POINT="/mnt/localrepo"
REPO_FILE="/etc/yum.repos.d/CentOS-7.9.repo"

# 1. åˆ›å»ºæŒ‚è½½ç›®å½•
sudo mkdir -p "$MOUNT_POINT"

# 2. æ£€æŸ¥ /etc/fstab æ˜¯å¦å·²åŒ…å«è¯¥æŒ‚è½½é¡¹ï¼Œé¿å…é‡å¤
if ! grep -qF "$ISO_PATH" /etc/fstab; then
    echo "$ISO_PATH $MOUNT_POINT iso9660 defaults,ro,loop 0 0" | sudo tee -a /etc/fstab >/dev/null
    echo "Added mount entry to /etc/fstab"
else
    echo "Mount entry already exists in /etc/fstab"
fi

# 3. åˆ›å»º YUM ä»“åº“æ–‡ä»¶
cat <<EOF | sudo tee "$REPO_FILE" >/dev/null
[CentOS7.9]
name=CentOS7.9
baseurl=file://$MOUNT_POINT
enabled=1
gpgcheck=1
gpgkey=file://$MOUNT_POINT/RPM-GPG-KEY-CentOS-7
EOF

echo "Created YUM repo file: $REPO_FILE"

# 4. ï¼ˆå¯é€‰ï¼‰ç«‹å³æŒ‚è½½ ISO å¹¶æ¸…ç† yum ç¼“å­˜
if mountpoint -q "$MOUNT_POINT"; then
    echo "Already mounted: $MOUNT_POINT"
else
    if [ -f "$ISO_PATH" ]; then
        sudo mount -a
        echo "Mounted ISO to $MOUNT_POINT"
    else
        echo "ERROR: ISO file not found at $ISO_PATH" >&2
        exit 1
    fi
fi

# 5. æ¸…ç† yum ç¼“å­˜ï¼ˆç¡®ä¿ä½¿ç”¨æ–° repoï¼‰
sudo yum clean all
echo "Local CentOS 7.9 repository setup completed!"
)
```

:::

2. æ›´æ¢yumæºé…ç½®ä¸ºé˜¿é‡Œäº‘æºé…ç½®

   1. å¤‡ä»½

   ```bash
   $ sudo mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
   ```

   2. ä¸‹è½½æ–°çš„CentOS-Base.repoåˆ°/etc/yum.repos.d/ç›®å½•

   ```bash
   $ sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
   ```

   ã€å¤‡æ³¨ã€‘å¦‚æœæç¤ºæ— æ³•è§£æ`mirrors.aliyun.com`ï¼Œåº”è¯¥æ˜¯å½“å‰ä¼šè¯çš„DNSå±äºå†…ç½‘IPï¼Œåªéœ€è¦å†å¢åŠ `8.8.8.8`è¿™ä¸ªDNSå³å¯ã€‚

5. æŸ¥çœ‹å¯ç”¨çš„yum

```bash
$ sudo yum repolist all
```

4. ç¼“å­˜æœåŠ¡å™¨åŒ…ä¿¡æ¯ï¼Œä¹‹åé…åˆ`yum -C search xxx`å¯ç”¨ä¸ç”¨è”ç½‘å³å¯æ£€ç´¢è½¯ä»¶ä¿¡æ¯

```bash
# æ¸…ç†æ‰€æœ‰æ—§ç¼“å­˜
$ sudo yum clean all
# ç”Ÿæˆæ–°ä»“åº“çš„å…ƒæ•°æ®ç¼“å­˜
$ sudo yum makecache
```
