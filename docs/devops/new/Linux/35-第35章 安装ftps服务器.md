# ç¬¬35ç«  å®‰è£…ftpsæœåŠ¡å™¨

**ftps=ftp+ssl**

- ä¸ºftpæ·»åŠ sslåŠŸèƒ½çš„æ–¹å¼
    - ä½¿ç”¨è‡ªç­¾åè¯ä¹¦
    - ä½¿ç”¨ç§æœ‰CAç­¾åè¯ä¹¦
    - ä½¿ç”¨å…¬ä¿¡CAç­¾åè¯ä¹¦

**opensslå®‰è£…æ£€æŸ¥**

ç”±äºè¦ä½¿ç”¨åˆ°opensslï¼Œè¿™é‡Œå…ˆæ£€æŸ¥opensslå®‰è£…æƒ…å†µã€‚

```bash
[emon@wenqiu ~]$ yum list openssl|tail -n 2
å·²å®‰è£…çš„è½¯ä»¶åŒ…
openssl.x86_64                     1:1.0.2k-12.el7                     @anaconda
```

### 5.1ã€æ–¹å¼ä¸€ï¼šä½¿ç”¨è‡ªç­¾åè¯ä¹¦

1. åˆ‡æ¢ç›®å½•

```bash
[emon@wenqiu ~]$ cd /etc/ssl/certs/
[emon@wenqiu certs]$ ls
ca-bundle.crt  ca-bundle.trust.crt  make-dummy-cert  Makefile  renew-dummy-cert
```

2. ç”ŸæˆRSAç§é’¥å’Œè‡ªç­¾åè¯ä¹¦

```bash
[emon@wenqiu certs]$ sudo openssl req -newkey rsa:2048 -nodes -keyout rsa_private.key -x509 -days 365 -out cert.crt
[sudo] emon çš„å¯†ç ï¼š
Generating a 2048 bit RSA private key
..................+++
..........................+++
writing new private key to 'rsa_private.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:ZheJiang
Locality Name (eg, city) [Default City]:HangZhou
Organization Name (eg, company) [Default Company Ltd]:HangZhou emon Technologies,Inc.
Organizational Unit Name (eg, section) []:IT emon
Common Name (eg, your name or your server's hostname) []:*.emon.vip
Email Address []:
```

3. æŸ¥çœ‹ç”Ÿæˆçš„RSAç§é’¥å’Œè‡ªç­¾åè¯ä¹¦

```bash
[emon@wenqiu certs]$ ls
ca-bundle.crt  ca-bundle.trust.crt  cert.crt  make-dummy-cert  Makefile  renew-dummy-cert  rsa_private.key
```

4. é…ç½®`vsftpd.conf`

```bash
[emon@wenqiu certs]$ sudo vim /etc/vsftpd/vsftpd.conf
```

```bash
# ssl config
# æ˜¯å¦ä½¿ç”¨ssl
ssl_enable=YES
# æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä½¿ç”¨ssl
allow_anon_ssl=NO
# å¼ºåˆ¶æœ¬åœ°ç”¨æˆ·ç™»å½•ä½¿ç”¨ssl
force_local_logins_ssl=YES
# å¼ºåˆ¶æœ¬åœ°ç”¨æˆ·æ•°æ®ä½¿ç”¨sslä¼ è¾“
force_local_data_ssl=YES
# å¼ºåˆ¶åŒ¿å/è™šæ‹Ÿç”¨æˆ·ç™»å½•ä½¿ç”¨ssl
force_anon_logins_ssl=YES
# å¼ºåˆ¶åŒ¿å/è™šæ‹Ÿç”¨æˆ·æ•°æ®ä½¿ç”¨sslä¼ è¾“
force_anon_data_ssl=YES
# å…è®¸ TLS v1 åè®®è¿æ¥
ssl_tlsv1=YES
# å…è®¸ SSL v2 åè®®è¿æ¥
ssl_sslv2=YES
# å¼€å¯sslv3
ssl_sslv3=YES

# æ˜¯å¦å¯ç”¨éšå¼SSLåŠŸèƒ½ï¼Œä¸å»ºè®®å¼€å¯ï¼Œè€Œä¸”é»˜è®¤æ˜¯å…³é—­çš„
implicit_ssl=NO
# éšå¼ftpç«¯å£è®¾ç½®ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤è¿˜æ˜¯21ï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯ä»¥éšå¼SSLè¿æ¥æ—¶ï¼Œé»˜è®¤ä¼šä½¿ç”¨990ç«¯å£ï¼Œå¯¼è‡´è¿æ¥å¤±è´¥ï¼ï¼ï¼
# listen_port=990
# è¾“å‡ºSSLç›¸å…³çš„æ—¥å¿—ä¿¡æ¯
# debug_ssl=YES
# Disable SSL session reuse(required by WinSCP)
require_ssl_reuse=NO
# Select which SSL ciphers vsftpd will allow for encrypted SSL connectionsï¼ˆrequired by FileZillaï¼‰
ssl_ciphers=HIGH
# è‡ªç­¾è¯ä¹¦ï¼šè¯ä¹¦æ–‡ä»¶
rsa_cert_file=/etc/ssl/certs/cert.crt
# è‡ªç­¾è¯ä¹¦ï¼šRSAç§é’¥æ–‡ä»¶
rsa_private_key_file=/etc/ssl/certs/rsa_private.key
```

sslæœ‰æ˜¾å¼`explicit`å’Œéšå¼`implicit`ä¹‹åˆ†ï¼š

- æ˜¾å¼é…ç½®

```bash
implicit_ssl=NO
```

- éšå¼é…ç½®

```bash
implicit_ssl=YES
listen_port=990
```

5. é‡å¯vsftpdæœåŠ¡

```bash
[emon@wenqiu certs]$ sudo systemctl restart vsftpd
```

6. æ ¡éªŒ

å¯¹äºftpsçš„æ ¡éªŒï¼Œæ— æ³•ä½¿ç”¨ftpå‘½ä»¤æ ¡éªŒäº†ï¼š

```bash
[emon@wenqiu certs]$ sudo systemctl restart vsftpd
[sudo] emon çš„å¯†ç ï¼š
[emon@wenqiu certs]$ ftp 127.0.0.1
Connected to 127.0.0.1 (127.0.0.1).
220 Welcome to emon FTP service
Name (127.0.0.1:emon): ftp
530 Anonymous sessions must use encryption.
Login failed.
421 Service not available, remote server has closed connection
ftp> 
```

**éœ€è¦å®‰è£…lftpæ ¡éªŒ**

å¦‚æœæ˜¯æ˜¾å¼`explicit` çš„ftpsï¼Œè¿˜å¯ä»¥ä½¿ç”¨lftpæµ‹è¯•ï¼š

- å®‰è£…lftp

```bash
[emon@wenqiu certs]$ sudo yum install -y lftp
[emon@wenqiu certs]$ lftp ftp@127.0.0.1:21
å£ä»¤: 
lftp ftp@127.0.0.1:~> ls            
ls: ä¸¥é‡é”™è¯¯: Certificate verification: Not trusted
lftp ftp@127.0.0.1:~> 
```

- ç¼–è¾‘`/etc/lftp.conf`

æ‰“å¼€æ–‡ä»¶åï¼Œåœ¨æœ€åä¸€è¡Œè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
[emon@wenqiu certs]$ sudo vim /etc/lftp.conf 
# ä¸ªäººé…ç½®
set ssl:verify-certificate no
```

å†æ¬¡æ ¡éªŒï¼š

```bash
[emon@wenqiu certs]$ lftp ftp@127.0.0.1:21
å£ä»¤: 
lftp ftp@127.0.0.1:~> ls            
-rw-r--r--    1 1001     1001         1006 May 27 15:44 index.html
drwxr-xr-x    2 1001     1001            6 May 27 15:53 test
lftp ftp@127.0.0.1:/> 
```

å¦‚æœæ˜¯éšå¼çš„ftpsï¼Œlftpå°±æ— æ³•æ ¡éªŒäº†ï¼Œé™¤élftpæ˜¯` compiled with OpenSSL (configure --with-openssl)`ï¼š

```bash
[emon@wenqiu certs]$ lftp ftp@127.0.0.1:990
Password: 
lftp ftp@127.0.0.1:~> ls
`ls' at 0 [FEAT negotiation...]
```

æ€ä¹ˆåŠå‘¢ï¼Ÿ **æ¨èä½¿ç”¨Windowsæ“ä½œç³»ç»Ÿçš„FlashFXPè½¯ä»¶éªŒè¯ã€‚**



---

#### 5.1.1ã€å®‰è£…lftpã€æºç å®‰è£…ã€‘

å‘½ä»¤`yum install -y lftp`å®‰è£…çš„lftpï¼Œå¯ä»¥æµ‹è¯•æ˜¾å¼çš„ftpsï¼Œä½†æ— æ³•æµ‹è¯•éšå¼çš„ftpsï¼Œè¿™é‡Œé‡‡ç”¨æºç ç¼–è¯‘å®‰è£…ã€‚

1. ä¸‹è½½

ä¸‹è½½åœ°å€è·å–é¡µé¢ï¼š http://lftp.yar.ru/get.html

```bash
[emon@wenqiu certs]$ wget -cP /usr/local/src/ http://lftp.yar.ru/ftp/lftp-4.8.3.tar.gz
```

2. ä¾èµ–å®‰è£…

```bash
[emon@wenqiu certs]$ sudo yum install -y gcc* *md5* openssl* ncurses* readline-devel
```

3. åˆ›å»ºè§£å‹ç›®å½•

```bash
[emon@wenqiu certs]$ mkdir /usr/local/LFTP
```

4. è§£å‹

```bash
[emon@wenqiu certs]$ tar -zxvf /usr/local/src/lftp-4.8.3.tar.gz -C /usr/local/LFTP/
```

5. æ‰§è¡Œé…ç½®è„šæœ¬ï¼Œå¹¶ç¼–è¯‘å®‰è£…

- åˆ‡æ¢ç›®å½•å¹¶æ‰§è¡Œé…ç½®è„šæœ¬ç”ŸæˆMakefile

```bash
[emon@wenqiu certs]$ cd /usr/local/LFTP/lftp-4.8.3/
[emon@wenqiu lftp-4.8.3]$ ./configure --prefix=/usr/local/LFTP/lftp4.8.3 --with-openssl
```

- ç¼–è¯‘

```bash
[emon@wenqiu lftp-4.8.3]$ make
```

- å®‰è£…

```bash
[emon@wenqiu lftp-4.8.3]$ make install
[emon@wenqiu lftp-4.8.3]$ cd /etc/ssl/certs/
```

6. åˆ›å»ºè½¯è¿æ¥

```bash
[emon@wenqiu certs]$ ln -s /usr/local/LFTP/lftp4.8.3/ /usr/local/lftp
```

7. é…ç½®ç¯å¢ƒå˜é‡

åœ¨`/etc/profile.d`ç›®å½•åˆ›å»º`.sh`æ–‡ä»¶ï¼š

```bash
[emon@wenqiu certs]$ sudo vim /etc/profile.d/lftp.sh
export PATH=/usr/local/lftp/bin:$PATH
```

ä½¿ä¹‹ç”Ÿæ•ˆï¼š

```bash
[emon@wenqiu certs]$ source /etc/profile
```

8. é…ç½®`lftp.conf`

æ‰“å¼€æ–‡ä»¶åï¼Œåœ¨æœ€åä¸€è¡Œè¿½åŠ å¦‚ä¸‹å†…å®¹ï¼š

```bash
[emon@wenqiu certs]$ vim /usr/local/lftp/etc/lftp.conf
# ä¸ªäººé…ç½®
set ssl:verify-certificate no
```

**ç´§æ¥ä¸Šé¢çš„æ ¡éªŒï¼Œè¿™é‡Œä½¿ç”¨lftpå‘½ä»¤ï¼š**

```bash
[emon@wenqiu certs]$ lftp ftp@127.0.0.1:21
å£ä»¤: 
lftp ftp@127.0.0.1:~> ls                        
-rw-r--r--    1 1001     1001         1006 May 27 15:44 index.html
drwxr-xr-x    2 1001     1001            6 May 27 15:53 test
lftp ftp@127.0.0.1:/> exit
```

**å¦‚æœftpsæ˜¯éšå¼ï¼Œå‘ç°è¿˜æ˜¯æ— æ³•è¿æ¥**

---

### 5.2ã€æ–¹å¼äºŒï¼šä½¿ç”¨ç§æœ‰CAç­¾åè¯ä¹¦

ç§æœ‰CAç­¾åè¯ä¹¦çš„ä½¿ç”¨ä¸è‡ªç­¾åè¯ä¹¦ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œä¸»è¦è®²è§£å¦‚ä½•ç”Ÿæˆç§æœ‰CAç­¾åè¯ä¹¦ã€‚

#### ç›¸å…³çŸ¥è¯†ç‚¹

> - è¯ä¹¦ç­¾å‘æœºæ„CA
    >
    >   - å…¬å…±ä¿¡ä»»CA
          >
          >     å¤§èŒƒå›´ç»´æŠ¤å¤§é‡è¯ä¹¦ä¼ä¸šä½¿ç”¨OpenCAï¼ˆå¯¹opensslè¿›è¡Œäº†äºŒæ¬¡å°è£…ï¼Œæ›´åŠ æ–¹ä¾¿ä½¿ç”¨ï¼‰
>
>   - ç§æœ‰CA
      >
      >     å°èŒƒå›´æµ‹è¯•ä½¿ç”¨openssl
>
> - opensslé…ç½®æ–‡ä»¶
    >
    >   > /etc/pki/tls/openssl.cnf

#### 5.2.1ã€åˆ›å»ºç§æœ‰è¯ä¹¦ç­¾å‘æœºæ„CAæ­¥éª¤

åœ¨ç¡®å®šé…ç½®ä¸ºCAçš„æœåŠ¡å™¨ä¸»æœºä¸Šç”Ÿæˆä¸€ä¸ªè‡ªç­¾è¯ä¹¦ï¼Œå¹¶ä¸ºCAæä¾›æ‰€éœ€è¦çš„ç›®å½•åŠæ–‡ä»¶ã€‚åœ¨çœŸæ­£çš„é€šä¿¡è¿‡ç¨‹ä¸­CAæœåŠ¡å™¨ä¸»æœºä¸éœ€è¦ç½‘ç»œå‚ä¸ï¼Œåªéœ€è¦å‚ä¸åˆ°ç­¾åä¸­ï¼Œä¸éœ€è¦æä¾›æœåŠ¡ã€‚

1. ç”Ÿæˆç§é’¥

å› ä¸ºåœ¨é»˜è®¤é…ç½®æ–‡ä»¶ä¸­CAè‡ªå·±çš„ç§é’¥é…ç½®åœ¨`/etc/pki/CA/private/cakey.pem`ï¼Œæ‰€ä»¥æŒ‡å®šç›®å½•å’Œæ–‡ä»¶åè¦å’Œé…ç½®æ–‡ä»¶ä¸€è‡´ã€‚

```bash
[emon@wenqiu certs]$ sudo bash -c "umask 077;openssl genrsa -out /etc/pki/CA/private/cakey.pem 4096"
[sudo] emon çš„å¯†ç ï¼š
Generating RSA private key, 4096 bit long modulus
......................................................................................................++
.........................++
e is 65537 (0x10001)
[emon@wenqiu certs]$ sudo ls -l /etc/pki/CA/private/cakey.pem
-rw-------. 1 root root 3243 5æœˆ  27 19:13 /etc/pki/CA/private/cakey.pem
```

2. ç”ŸæˆCAè‡ªç­¾è¯ä¹¦

```bash
[emon@wenqiu certs]$ sudo openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3650
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:ZheJiang
Locality Name (eg, city) [Default City]:HangZhou
Organization Name (eg, company) [Default Company Ltd]:HangZhou emon Technologies,Inc.
Organizational Unit Name (eg, section) []:IT emon
Common Name (eg, your name or your server's hostname) []:*.emon.vip
Email Address []:
```

å‘½ä»¤è§£é‡Šï¼š

- `/etc/pki/CA/cacert.pem` : CAè‡ªç­¾è¯ä¹¦é»˜è®¤ä½ç½®
- `-new` : ç”Ÿæˆæ–°è¯ä¹¦ç­¾ç½²è¯·æ±‚
- `-x509` ï¼š ç”Ÿæˆè‡ªç­¾æ ¼å¼è¯ä¹¦ï¼Œä¸“ç”¨äºåˆ›å»ºç§æœ‰CAæ—¶
- `-key` ï¼š ç”Ÿæˆè¯·æ±‚æ—¶ç”¨åˆ°çš„ç§æœ‰æ–‡ä»¶è·¯å¾„
- `-out` ï¼š ç”Ÿæˆçš„è¯·æ±‚æ–‡ä»¶è·¯å¾„ï¼Œå¦‚æœè‡ªç­¾æ“ä½œå°†ç›´æ¥ç”Ÿæˆç­¾ç½²è¿‡çš„è¯ä¹¦
- `-days` ï¼š è¯ä¹¦çš„æœ‰æ•ˆæ—¶é•¿ï¼Œå•ä½æ˜¯day

æ³¨æ„ï¼š

- `-key /etc/pki/CA/private/cakey.pem` æŒ‡æ˜çš„æ˜¯ç§é’¥çš„ä½ç½®ï¼Œåªæ˜¯å› ä¸ºæ­¤å¤„ä¼šè‡ªåŠ¨æŠ½å–å‡ºç§é’¥ä¸­çš„å…¬é’¥ã€‚
- reqåªèƒ½å‘èµ·ç­¾ç½²è¯·æ±‚ï¼Œéœ€è¦åŠ -x509å‚æ•°å®ç°è‡ªå·±å‘å‡ºè¯·æ±‚ï¼Œè‡ªå·±ç­¾ç½²ã€‚éè‡ªç­¾æ— éœ€æ­¤å‚æ•°ã€‚

3. ä¸ºCAæä¾›æ‰€éœ€çš„ç›®å½•åŠæ–‡ä»¶

å½“ä¸å­˜åœ¨æ—¶éœ€è¦åˆ›å»ºç­¾å‘è¯ä¹¦ã€åŠé”€è¯ä¹¦ã€æ–°è¯ä¹¦ç›®å½•

```bash
[emon@wenqiu certs]$ sudo mkdir -pv /etc/pki/CA/{certs,crl,newcerts}
```

åˆ›å»ºè¯ä¹¦åºåˆ—å·æ–‡ä»¶ã€è¯ä¹¦ç´¢å¼•æ–‡ä»¶

```bash
[emon@wenqiu certs]$ sudo touch /etc/pki/CA/{serial,index.txt}
```

ç¬¬ä¸€æ¬¡åˆ›å»ºçš„æ—¶å€™éœ€è¦ç»™äºˆè¯ä¹¦åºåˆ—å·

```bash
[emon@wenqiu certs]$ echo 01 | sudo tee /etc/pki/CA/serial
01
```

#### 5.2.2ã€OpenSSLï¼šæœåŠ¡ç”³è¯·è¯ä¹¦ç­¾ç½²å®ç°SSLå®‰å…¨é€šä¿¡

è¦ç”¨åˆ°è¯ä¹¦è¿›è¡Œå®‰å…¨é€šä¿¡çš„æœåŠ¡å™¨ï¼Œéœ€è¦å‘CAè¯·æ±‚ç­¾ç½²è¯ä¹¦ï¼Œéœ€è¦ç­¾ç½²çš„æœåŠ¡æ— éœ€å’ŒCAè¯ä¹¦ç­¾ç½²æœºæ„ä¸»æœºåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚

1. ç”¨åˆ°è¯ä¹¦çš„æœåŠ¡å™¨ç”Ÿæˆç§é’¥

ç”ŸæˆvsftpdæœåŠ¡çš„ç§é’¥åˆ›å»ºæ—¶å€™æ— éœ€åœ¨`/etc/pki/CA/private`ç›®å½•åˆ›å»ºï¼Œè¯¥ç›®å½•ä»…åœ¨åˆ›å»ºCAä¸»æœºæ—¶éœ€è¦çš„ã€‚

```bash
[emon@wenqiu certs]$ sudo mkdir /etc/vsftpd/ssl
[emon@wenqiu certs]$ cd /etc/vsftpd/ssl/
[emon@wenqiu ssl]$ sudo bash -c "umask 077; openssl genrsa -out /etc/vsftpd/ssl/vsftpd.key 2048"
Generating RSA private key, 2048 bit long modulus
..+++
................+++
e is 65537 (0x10001)
[emon@wenqiu ssl]$ ll
æ€»ç”¨é‡ 4
-rw-------. 1 root root 1675 5æœˆ  27 19:22 vsftpd.key
```

2. ç”Ÿæˆè¯ä¹¦ç­¾ç½²è¯·æ±‚

```bash
[emon@wenqiu ssl]$ sudo openssl req -new -key /etc/vsftpd/ssl/vsftpd.key -out /etc/vsftpd/ssl/vsftpd.csr -days 365
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [XX]:CN
State or Province Name (full name) []:ZheJiang
Locality Name (eg, city) [Default City]:HangZhou
Organization Name (eg, company) [Default Company Ltd]:HangZhou emon Technologies,Inc.
Organizational Unit Name (eg, section) []:IT emon
Common Name (eg, your name or your server's hostname) []:*.emon.vip
Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
```

å‘½ä»¤è§£é‡Šï¼š

- `*.csr` ï¼š è¡¨ç¤ºè¯ä¹¦ç­¾ç½²è¯·æ±‚æ–‡ä»¶
- è¦ä¿è¯å’Œç­¾ç½²æœºæ„CAç­¾ç½²æœºæ„ä¿¡æ¯ä¸€è‡´

ç”Ÿæˆç­¾åè¯·æ±‚æ—¶ï¼Œæœ‰ä¸¤é¡¹é¢å¤–çš„ä¿¡æ¯éœ€è¦å¡«å†™ï¼š

| å­—æ®µ                     | è¯´æ˜           | ç¤ºä¾‹     |
| ------------------------ | -------------- | -------- |
| A challenge password     | é«˜å¼ºåº¦çš„å¯†ç    | æ— éœ€å¡«å†™ |
| An optional company name | å¯é€‰çš„å…¬å¸åç§° | æ— éœ€å¡«å†™ |

3. å°†è¯·æ±‚é€šè¿‡å¯é æ–¹å¼å‘é€ç»™CAä¸»æœº

```bash
[emon@wenqiu ssl]$ sudo scp /etc/vsftpd/ssl/vsftpd.csr root@127.0.0.1:/tmp/
The authenticity of host '127.0.0.1 (127.0.0.1)' can't be established.
ECDSA key fingerprint is SHA256:Z9evxGkdmtBGu8pEB1oRNAiy3N32cEbJUL9uK71UTMo.
ECDSA key fingerprint is MD5:f0:62:1e:0b:64:61:31:df:f5:46:79:2ağŸ‡©ğŸ‡ª45:47:b2.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '127.0.0.1' (ECDSA) to the list of known hosts.
root@127.0.0.1's password: 
vsftpd.csr                                                                                           100% 1045   829.5KB/s   00:00    
```

4. åœ¨CAä¸»æœºä¸Šç­¾ç½²è¯ä¹¦

```bash
$ sudo cd /tmp/
[root@wenqiu tmp]# openssl ca -in /tmp/vsftpd.csr -out /etc/pki/CA/certs/vsftpd.crt -days 3650
Using configuration from /etc/pki/tls/openssl.cnf
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number: 1 (0x1)
        Validity
            Not Before: May 27 11:31:44 2018 GMT
            Not After : May 27 11:31:44 2019 GMT
        Subject:
            countryName               = CN
            stateOrProvinceName       = ZheJiang
            organizationName          = HangZhou emon Technologies,Inc.
            organizationalUnitName    = IT emon
            commonName                = *.emon.vip
        X509v3 extensions:
            X509v3 Basic Constraints: 
                CA:FALSE
            Netscape Comment: 
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier: 
                C6:1E:78:65:26:2E:24:A0:7D:A1:52:40:A6:2E:5D:34:AD:77:F9:E6
            X509v3 Authority Key Identifier: 
                keyid:35:E2:12:FF:1F:4B:5B:80:45:E1:95:5D:60:F5:E6:BD:F0:BF:8E:43

Certificate is to be certified until May 27 11:31:44 2019 GMT (365 days)
Sign the certificate? [y/n]:y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
```

5. æŸ¥çœ‹æ‰€ç­¾ç½²çš„è¯ä¹¦ä¿¡æ¯

- æ–¹æ³•ä¸€

```bash
[root@wenqiu tmp]# cat /etc/pki/CA/index.txt
V	190527113144Z		01	unknown	/C=CN/ST=ZheJiang/O=HangZhou emon Technologies,Inc./OU=IT emon/CN=*.emon.vip
```

`V` ï¼š è¡¨ç¤ºå·²ç»ç­¾ç½²çš„

`01` ï¼š è¡¨ç¤ºè¯ä¹¦åºåˆ—å·

`/C=CN/ST=ZheJiang/O=......`ï¼š è¡¨ç¤ºä¸»é¢˜ä¿¡æ¯

- æ–¹æ³•äºŒ

```bash
[root@wenqiu tmp]# openssl x509 -in /etc/pki/CA/certs/vsftpd.crt -noout -serial -subject
serial=01
subject= /C=CN/ST=ZheJiang/O=HangZhou emon Technologies,Inc./OU=IT emon/CN=*.emon.vip
```

`serial`ï¼š åºåˆ—å·

`subject` ï¼š ä¸»é¢˜ä¿¡æ¯

6. å°†CAç­¾ç½²æœºæ„çš„.crtè¯ä¹¦å‘é€ç»™æœåŠ¡å™¨

```bash
[root@wenqiu tmp]# scp /etc/pki/CA/certs/vsftpd.crt root@127.0.0.1:/etc/vsftpd/ssl/
root@127.0.0.1's password: 
vsftpd.crt                                                                                           100% 5843     2.5MB/s   00:00    
```

7. åˆ é™¤æœåŠ¡å™¨å’ŒCAä¸»æœºä¸Šç­¾ç½²å‰çš„`*.csr`æ–‡ä»¶ï¼Œç¡®ä¿å®‰å…¨

CAä¸»æœºï¼š

```bash
[root@wenqiu tmp]# rm -rf /tmp/vsftpd.csr
```

vsftpdä¸»æœºï¼š

```bash
[emon@wenqiu ssl]$ sudo rm -rf /etc/vsftpd/ssl/vsftpd.csr
```

8. é…ç½®`vsftpd.conf`

```bash
# ç§æœ‰CAè¯ä¹¦:è¯ä¹¦æ–‡ä»¶
rsa_cert_file=/etc/vsftpd/ssl/vsftpd.crt
# ç§æœ‰CAè¯ä¹¦:RSAç§é’¥æ–‡ä»¶
rsa_private_key_file=/etc/vsftpd/ssl/vsftpd.key
```

### 5.3ã€æ–¹å¼ä¸‰ï¼šä½¿ç”¨å…¬ä¿¡CAç­¾åè¯ä¹¦

å…¶å®ï¼Œæ–¹å¼äºŒå·²ç»è®²è§£äº†å¦‚ä½•å‘CAç”³è¯·è¯ä¹¦ï¼Œåªä¸è¿‡é‚£ä¸ªæ˜¯ç§æœ‰CAè€Œå·²ã€‚

æ­¥éª¤å¦‚ä¸‹ï¼š

1. ç”¨åˆ°è¯ä¹¦çš„æœåŠ¡å™¨ç”Ÿæˆç§é’¥
2. ç”Ÿæˆè¯ä¹¦ç­¾ç½²è¯·æ±‚
3. å°†è¯·æ±‚é€šè¿‡å¯é æ–¹å¼å‘é€ç»™CAä¸»æœº